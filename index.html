<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  
  <meta name="theme-color" content="#000000">
  <meta name="msapplication-TileColor" content="#000000">
  
  <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="manifest" href="/site.webmanifest">
  
  <title>Webcam Montefalcone di Val Fortore</title>
  <meta name="description" content="Webcam in diretta dal Comune di Montefalcone. Vista panoramica e condizioni meteo attuali">
  <meta name="robots" content="index, follow">
  <meta name="google-site-verification" content="DLjKDn5UupGNdRgZXo9CuMc0Sg1S1aULxDJfIHT9tYo">
  <link rel="canonical" href="https://www.webcammontefalconedivalfortore.it/">
  
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://www.webcammontefalconedivalfortore.it/">
  <meta property="og:title" content="Webcam Montefalcone di Val Fortore - LIVE">
  <meta property="og:description" content="Guarda cosa succede ora a Montefalcone.">
  <meta property="og:image" content="https://www.webcammontefalconedivalfortore.it/p.png">
  <meta property="og:locale" content="it_IT">
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://live.webcammontefalconedivalfortore.it" crossorigin>
  
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --color-bg: #000;
      --color-live: #ff2b2b;
      --color-white: #fff;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    html, body {
      width: 100%;
      height: 100%;
      overflow: hidden;
      background: var(--color-bg);
      font-family: "Poppins", sans-serif;
    }

    @font-face {
      font-family: 'MerryChristmasFont';
      src: url('last.otf') format('opentype');
      font-display: swap;
    }

    /* Layout */
    .page {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    /* Background */
    .bg {
      position: absolute;
      inset: 0;
      background: url("1a.webp") center/cover no-repeat;
      filter: brightness(0.6);
      z-index: 0;
    }

    .vignette {
      position: absolute;
      inset: 0;
      background: radial-gradient(circle, transparent 30%, rgba(0,0,0,0.8) 100%);
      z-index: 1;
    }

    /* Content */
    .content {
      position: relative;
      z-index: 10;
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
      max-width: 900px;
      padding: 20px;
    }

    .logo {
      width: 100px;
      margin-bottom: 15px;
      filter: drop-shadow(0 0 10px rgba(255,215,0,0.5));
    }

    .title {
      font-family: 'MerryChristmasFont', cursive;
      color: var(--color-white);
      font-size: clamp(1.8rem, 5vw, 3.5rem);
      text-align: center;
      margin-bottom: 25px;
      text-shadow: 2px 2px 8px rgba(0,0,0,0.8);
    }

    /* Player Container */
    .player-wrap {
      position: relative;
      width: 100%;
      aspect-ratio: 16/9;
      background: #000;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 20px 60px rgba(0,0,0,0.8);
    }

    /* Video - IL CUORE: semplicissimo */
    #video {
      width: 100%;
      height: 100%;
      background: #000;
      object-fit: contain;
    }

    /* Poster/Loading - mostrato SOLO prima del primo frame */
    .poster {
      position: absolute;
      inset: 0;
      background: url("https://www.webcammontefalconedivalfortore.it/p.png") center/cover;
      filter: blur(15px) brightness(0.4);
      transform: scale(1.1);
      z-index: 5;
      transition: opacity 0.3s ease;
    }

    .poster.hidden { opacity: 0; pointer-events: none; }

    .loader {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 6;
      text-align: center;
      transition: opacity 0.3s ease;
    }

    .loader.hidden { opacity: 0; pointer-events: none; }

    .spinner {
      width: 40px;
      height: 40px;
      border: 3px solid rgba(255,255,255,0.2);
      border-top-color: #fff;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin: 0 auto 10px;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    .loader-text {
      color: rgba(255,255,255,0.8);
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }

    /* Live Badge */
    .live-badge {
      position: absolute;
      bottom: 12px;
      left: 12px;
      z-index: 20;
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      background: rgba(0,0,0,0.6);
      border-radius: 20px;
      backdrop-filter: blur(10px);
    }

    .live-dot {
      width: 8px;
      height: 8px;
      background: var(--color-live);
      border-radius: 50%;
      animation: pulse 1.5s infinite;
    }

    .paused .live-dot {
      background: #666;
      animation: none;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.4; }
    }

    .live-text {
      color: #fff;
      font-size: 11px;
      font-weight: 700;
      letter-spacing: 0.1em;
    }

    /* Controls Overlay */
    .controls {
      position: absolute;
      inset: 0;
      z-index: 15;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(0,0,0,0);
      opacity: 0;
      transition: opacity 0.2s ease, background 0.2s ease;
      cursor: pointer;
    }

    .controls.visible {
      opacity: 1;
      background: rgba(0,0,0,0.3);
    }

    .play-btn {
      width: 70px;
      height: 70px;
      background: rgba(0,0,0,0.5);
      border: 2px solid rgba(255,255,255,0.3);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      backdrop-filter: blur(5px);
      transition: transform 0.15s ease;
    }

    .play-btn:active { transform: scale(0.9); }

    .play-btn svg {
      width: 28px;
      height: 28px;
      fill: #fff;
      margin-left: 3px;
    }

    .play-btn .pause-icon { display: none; margin-left: 0; }
    .playing .play-btn .play-icon { display: none; }
    .playing .play-btn .pause-icon { display: block; }

    /* Fullscreen Button */
    .fs-btn {
      position: absolute;
      bottom: 12px;
      right: 12px;
      width: 40px;
      height: 40px;
      background: rgba(0,0,0,0.5);
      border: none;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      backdrop-filter: blur(10px);
      z-index: 20;
      opacity: 0;
      transition: opacity 0.2s ease;
    }

    .controls.visible ~ .fs-btn { opacity: 1; }

    .fs-btn svg { width: 18px; height: 18px; fill: #fff; }

    /* Particles */
    .particles {
      position: absolute;
      inset: 0;
      z-index: 2;
      pointer-events: none;
      overflow: hidden;
    }

    .snow {
      position: absolute;
      background: #fff;
      border-radius: 50%;
      opacity: 0.8;
    }

    @keyframes fall {
      to { transform: translateY(100vh); }
    }

    /* Responsive */
    @media (max-width: 768px) {
      .content { padding: 15px; }
      .logo { width: 70px; margin-bottom: 10px; }
      .title { margin-bottom: 15px; }
      .player-wrap { border-radius: 8px; }
      .play-btn { width: 60px; height: 60px; }
      .play-btn svg { width: 24px; height: 24px; }
    }

    @media (max-width: 768px) and (orientation: portrait) {
      .page { justify-content: flex-start; padding-top: 15vh; }
    }

    @media (orientation: landscape) and (max-height: 500px) {
      .logo, .title, .bg, .vignette, .particles { display: none; }
      .page { background: #000; }
      .content { max-width: 100%; padding: 0; height: 100%; }
      .player-wrap { border-radius: 0; height: 100%; }
    }

    /* Fullscreen */
    .player-wrap:fullscreen,
    .player-wrap:-webkit-full-screen {
      border-radius: 0;
      width: 100vw;
      height: 100vh;
    }
  </style>
</head>
<body>
  <div class="page">
    <div class="bg"></div>
    <div class="vignette"></div>
    <div class="particles" id="particles"></div>

    <div class="content">
      <img src="stemma2-removebg-preview.png" alt="Stemma" class="logo" width="100" height="100">
      
      <h1 class="title">
        Il comune di Montefalcone di Val Fortore<br>augura a tutti Buone Feste
      </h1>

      <div class="player-wrap" id="player">
        <video id="video" playsinline muted></video>
        
        <div class="poster" id="poster"></div>
        <div class="loader" id="loader">
          <div class="spinner"></div>
          <div class="loader-text">Connessione...</div>
        </div>

        <div class="live-badge">
          <div class="live-dot"></div>
          <span class="live-text">LIVE</span>
        </div>

        <div class="controls" id="controls">
          <div class="play-btn" id="playBtn">
            <svg class="play-icon" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
            <svg class="pause-icon" viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
          </div>
        </div>

        <button class="fs-btn" id="fsBtn" aria-label="Fullscreen">
          <svg viewBox="0 0 24 24"><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/></svg>
        </button>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.7/dist/hls.min.js"></script>
  <script>
    (function() {
      const STREAM = 'https://live.webcammontefalconedivalfortore.it/memfs/58e0bcbe-f1bd-4c8b-85f7-b4566a3e5392.m3u8';
      
      const video = document.getElementById('video');
      const player = document.getElementById('player');
      const poster = document.getElementById('poster');
      const loader = document.getElementById('loader');
      const controls = document.getElementById('controls');
      const playBtn = document.getElementById('playBtn');
      const fsBtn = document.getElementById('fsBtn');
      
      let hls = null;
      let hideTimer = null;
      let firstPlay = true;

      // === INIT ===
      function init() {
        // Safari/iOS: HLS nativo
        if (video.canPlayType('application/vnd.apple.mpegurl')) {
          video.src = STREAM;
          video.load();
          tryPlay();
        } 
        // Altri browser: HLS.js
        else if (Hls.isSupported()) {
          hls = new Hls({
            // Config MINIMA - lascia i default di HLS.js che sono gi√† ottimizzati
            enableWorker: true,
            lowLatencyMode: false,
            backBufferLength: 30
          });
          
          hls.loadSource(STREAM);
          hls.attachMedia(video);
          
          hls.on(Hls.Events.MANIFEST_PARSED, tryPlay);
          
          hls.on(Hls.Events.ERROR, function(e, data) {
            if (data.fatal) {
              console.error('HLS Error:', data.type);
              // Unico recovery: ricarica tutto
              hls.destroy();
              setTimeout(init, 3000);
            }
          });
        } else {
          loader.querySelector('.loader-text').textContent = 'Browser non supportato';
        }

        bindEvents();
        createSnow();
      }

      function tryPlay() {
        video.play().catch(function() {
          // Autoplay bloccato - mostra controlli
          showControls();
          loader.classList.add('hidden');
        });
      }

      // === EVENTS ===
      function bindEvents() {
        // Video ready - nascondi loader
        video.addEventListener('playing', function() {
          poster.classList.add('hidden');
          loader.classList.add('hidden');
          player.classList.add('playing');
          player.classList.remove('paused');
          
          if (firstPlay) {
            firstPlay = false;
            hideControls();
          }
        });

        video.addEventListener('pause', function() {
          player.classList.remove('playing');
          player.classList.add('paused');
        });

        video.addEventListener('waiting', function() {
          // Buffering - non fare nulla, il browser gestisce
        });

        // Tap su video = toggle controlli
        controls.addEventListener('click', function(e) {
          if (e.target === playBtn || e.target.closest('.play-btn')) {
            togglePlay();
          } else {
            toggleControls();
          }
        });

        // Play button
        playBtn.addEventListener('click', function(e) {
          e.stopPropagation();
          togglePlay();
        });

        // Fullscreen
        fsBtn.addEventListener('click', toggleFullscreen);

        // Visibility change - SOLO riprendi se era in play
        document.addEventListener('visibilitychange', function() {
          if (document.visibilityState === 'visible' && !video.paused) {
            // Non fare nulla di speciale, il browser gestisce
          }
        });

        // Fullscreen change
        document.addEventListener('fullscreenchange', onFsChange);
        document.addEventListener('webkitfullscreenchange', onFsChange);
      }

      function togglePlay() {
        if (video.paused) {
          video.play();
        } else {
          video.pause();
        }
        showControls();
      }

      function showControls() {
        controls.classList.add('visible');
        clearTimeout(hideTimer);
        hideTimer = setTimeout(hideControls, 3000);
      }

      function hideControls() {
        if (!video.paused) {
          controls.classList.remove('visible');
        }
      }

      function toggleControls() {
        if (controls.classList.contains('visible')) {
          hideControls();
        } else {
          showControls();
        }
      }

      function toggleFullscreen() {
        if (document.fullscreenElement) {
          document.exitFullscreen();
        } else {
          player.requestFullscreen().catch(function() {
            // Fallback per iOS
            if (video.webkitEnterFullscreen) {
              video.webkitEnterFullscreen();
            }
          });
        }
      }

      function onFsChange() {
        // Orientamento landscape su mobile
        if (document.fullscreenElement) {
          screen.orientation?.lock?.('landscape').catch(function(){});
        } else {
          screen.orientation?.unlock?.();
        }
      }

      // === SNOW ===
      function createSnow() {
        const container = document.getElementById('particles');
        const count = window.innerWidth < 768 ? 30 : 50;
        
        for (let i = 0; i < count; i++) {
          const snow = document.createElement('div');
          snow.className = 'snow';
          const size = Math.random() * 3 + 2;
          snow.style.cssText = 
            'width:' + size + 'px;' +
            'height:' + size + 'px;' +
            'left:' + (Math.random() * 100) + 'vw;' +
            'top:' + (-Math.random() * 20) + 'vh;' +
            'animation:fall ' + (Math.random() * 5 + 5) + 's linear infinite;' +
            'animation-delay:' + (Math.random() * -10) + 's';
          container.appendChild(snow);
        }
      }

      // Start
      init();
    })();
  </script>
</body>
</html>
