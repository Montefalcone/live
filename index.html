<!DOCTYPE html>
<html lang="it">
<head>
  <meta name="google-site-verification" content="DLjKDn5UupGNdRgZXo9CuMc0Sg1S1aULxDJfIHT9tYo" />
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">

  <title>Webcam Montefalcone di Val Fortore - LIVE</title>

  <meta name="description" content="Guarda la webcam in diretta dal Comune di Montefalcone. Vista panoramica live, condizioni meteo attuali e immagini in tempo reale dal centro storico.">
  <meta name="keywords" content="webcam montefalcone, meteo montefalcone, comune di montefalcone live, telecamera diretta">
  <meta property="og:title" content="Webcam Montefalcone Live">
  <meta property="og:description" content="Guarda cosa succede ora a Montefalcone. Clicca per la diretta.">
  <meta property="og:image" content="https://www.webcammontefalconedivalfortore.it/p.png">
  <meta name="robots" content="index, follow">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hls.js/1.6.6/hls.min.js"></script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      /* ✅ Unico blur per LIVE + PLAY + FULLSCREEN */
      --ui-blur: 6px;

      /* ✅ stesso “vetro” per tutti */
      --glass-alpha: 0.18;
      --glass-border: rgba(255,255,255,.20);
      --glass-shadow: 0 10px 28px rgba(0,0,0,.22);
    }

    @media (min-width: 1024px) {
      #main-container{ transform: scale(0.965); transform-origin: center top; }
    }

    html, body {
      margin: 0; padding: 0;
      width: 100%; height: 100%;
      overflow: hidden;
      position: fixed;
      top: 0; left: 0;
      overscroll-behavior: none;
      touch-action: none;
      background-color: #000;
    }

    @font-face {
      font-family: 'MerryChristmasFont';
      src: url('last.otf') format('opentype');
      font-display: swap;
    }

    #main-container {
      width: 100%; height: 100%;
      display: flex; flex-direction: column;
      justify-content: center; align-items: center;
      position: relative; z-index: 20;
      transition: all 0.5s ease;
    }

    #bg-static {
      position: absolute;
      top: -10%; left: -10%; width: 120%; height: 120%;
      background-image: url("1a.webp");
      background-size: cover; background-position: center;
      z-index: 0;
      filter: brightness(0.65) contrast(1.15) saturate(1.1);
      animation: driftingWorld 80s ease-in-out infinite alternate;
      pointer-events: none;
    }
    @keyframes driftingWorld {
      0% { transform: translate(0, 0) scale(1); }
      100% { transform: translate(-2%, 2%) scale(1.05); }
    }

    .municipality-logo, .festive-message, .warm-flicker, .vignette, .particles-container {
      transition: opacity 0.5s ease;
      opacity: 1;
      pointer-events: none;
    }

    .municipality-logo {
      width: 110px; height: auto;
      margin-bottom: 15px; z-index: 30;
      filter: brightness(1.1) drop-shadow(0 0 15px rgba(255, 215, 0, 0.5));
    }

    .festive-message {
      font-family: 'MerryChristmasFont', serif;
      color: #ffffff; text-align: center;
      font-size: 3.5rem; line-height: 1.2; margin-bottom: 25px;
      text-shadow: 2px 2px 4px #000, 0 0 25px rgba(255, 255, 255, 0.6);
      z-index: 30; padding: 0 20px; width: 100%; box-sizing: border-box;
    }

    .video-wrapper {
      position: relative;
      width: auto; height: 60%;
      aspect-ratio: 16/9;
      border-radius: 15px; overflow: hidden; background: #000;
      box-shadow: 0 0 30px rgba(255, 220, 150, 0.2), 0 40px 80px rgba(0,0,0,0.95);
      border: 1px solid rgba(255, 255, 255, 0.15); z-index: 30;
      pointer-events: auto;
      transition: all 0.3s ease-out;
      will-change: width, height;
    }

    .video-wrapper:fullscreen,
    .video-wrapper:-webkit-full-screen,
    .video-wrapper:-moz-full-screen {
      border-radius: 0 !important;
      border: none !important;
      box-shadow: none !important;
      width: 100% !important;
      height: 100% !important;
    }

    /* ✅ forza compositing (meno glitch blur su Chrome) */
    #liveVideo{
      width:100%; height:100%;
      display:block;
      background:#000;
      object-fit:contain;

      filter: opacity(0.9999);
      -webkit-filter: opacity(0.9999);
      transform: translateZ(0);
      will-change: transform, filter;
    }

    /* Loading */
    .loading-overlay{
      position:absolute; inset:0;
      z-index: 90;
      display:flex; align-items:center; justify-content:center;
      background:#000;
      opacity:1;
      transition: opacity 260ms ease;
      pointer-events:none;
    }
    .video-wrapper.is-ready .loading-overlay{ opacity:0; }

    .loading-overlay .preview{
      position:absolute; inset:0;
      width:100%; height:100%;
      object-fit:cover;
      filter: brightness(.82) contrast(1.08);
      opacity:.85;
    }
    .loading-overlay .spinner{
      position:relative;
      width:46px; height:46px;
      border-radius:999px;
      border:3px solid rgba(255,255,255,.25);
      border-top-color: rgba(255,255,255,.92);
      animation: spin .9s linear infinite;
      box-shadow: 0 10px 28px rgba(0,0,0,.35);
      transform: translateZ(0) rotate(0deg);
      will-change: transform;
    }
    @keyframes spin {
      from { transform: translateZ(0) rotate(0deg); }
      to   { transform: translateZ(0) rotate(360deg); }
    }

    .tap-layer{
      position:absolute; inset:0;
      z-index: 10;
      pointer-events:auto;
    }

    /* ====== GLASS BUTTON SYSTEM (RISOLVE PLAY + FS STORTO) ====== */
    .glass-btn{
      position: relative;
      overflow: hidden;
      border-radius: 999px;
      background: transparent;
      border: none;

      -webkit-appearance: none;
      appearance: none;
      padding: 0;
      margin: 0;

      outline: none;
      -webkit-tap-highlight-color: transparent;

      transform: translateZ(0);
      will-change: opacity, transform;
      box-shadow: var(--glass-shadow);
    }

    .glass-btn::before{
      content:"";
      position:absolute; inset:0;
      border-radius: inherit;

      /* ✅ stesso identico vetro del LIVE */
      background: rgb(0 0 0 / var(--glass-alpha));

      backdrop-filter: blur(var(--ui-blur)) saturate(1.1);
      -webkit-backdrop-filter: blur(var(--ui-blur)) saturate(1.1);
    }

    .glass-btn::after{
      content:"";
      position:absolute; inset:0;
      border-radius: inherit;
      /* ✅ bordo pulito e non “ovale/storto” */
      box-shadow: inset 0 0 0 1px var(--glass-border);
      pointer-events:none;
    }

    .glass-btn > svg{
      position: relative;
      z-index: 1;
      display: block; /* ✅ evita baseline shift */
    }

    /* LIVE badge (rimane com’era, ma ora coerente) */
    .live-badge {
      position: absolute; left: 14px; bottom: 14px; z-index: 60;
      display: inline-flex; align-items: center; gap: 8px;
      padding: 8px 12px;
      border-radius: 999px;

      color: #fff;
      font-family: "Poppins", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      font-weight: 700;
      font-size: 12px;
      line-height: 1;
      letter-spacing: .14em;
      text-transform: uppercase;

      background: rgb(0 0 0 / var(--glass-alpha));
      box-shadow: var(--glass-shadow);

      backdrop-filter: blur(var(--ui-blur)) saturate(1.1);
      -webkit-backdrop-filter: blur(var(--ui-blur)) saturate(1.1);

      pointer-events: none;
      transform: translateZ(0);
    }

    .live-badge::after{
      content:"";
      position:absolute; inset:0;
      border-radius: inherit;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.18);
      pointer-events:none;
    }

    .live-dot {
      width: 8px; height: 8px;
      border-radius: 50%;
      background: #ff2b2b;
      box-shadow: 0 0 12px rgba(255, 43, 43, .95);
      animation: livePulse 1.6s infinite;
      flex: 0 0 auto;
    }
    @keyframes livePulse { 0%{opacity:1} 50%{opacity:.45} 100%{opacity:1} }

    /* OSD layer: warm (niente ritardo blur) */
    .osd{
      position:absolute; inset:0;
      z-index: 65;
      display:flex; align-items:center; justify-content:center;
      pointer-events:none;
      opacity: 0.001;
      transition: opacity 140ms ease;
      will-change: opacity;
      transform: translateZ(0);
    }
    .video-wrapper.controls-visible .osd{ opacity:1; }

    /* PLAY button */
    .osd-chip{
      width:84px; height:84px;
      display:grid;
      place-items:center;
      pointer-events:auto;
      cursor:pointer;
    }

    .osd-icon{ width:40px; height:40px; fill:#fff; opacity:.95; }
    .osd-icon.play{ display:none; }
    .video-wrapper.is-paused .osd-icon.play{ display:block; }
    .video-wrapper.is-paused .osd-icon.pause{ display:none; }

    /* FULLSCREEN: assoluto, clean, non “storto” */
    .fs-btn{
      position:absolute;
      right: 14px;
      bottom: 14px;
      z-index: 80;

      width:44px;
      height:44px;
      aspect-ratio: 1 / 1;

      display:grid;
      place-items:center;

      cursor:pointer;

      /* warm */
      opacity: 0.001;
      pointer-events: none;
      transition: opacity 180ms ease;
    }
    .video-wrapper.controls-visible .fs-btn{
      opacity: 1;
      pointer-events: auto;
    }

    .fs-icon{ width:22px; height:22px; fill:#fff; opacity:.95; }

    /* Mobile */
    @media (max-width: 768px) and (orientation: portrait) {
      #main-container { justify-content: flex-start; padding-top: 18vh; }
      .municipality-logo { width: 75px; margin-bottom: 10px; }
      .festive-message { font-size: 6vw; line-height: 1.4; margin-bottom: 20px; }
      .video-wrapper { width: 95%; height: auto; }
      #bg-static { animation: driftingWorldMobile 35s ease-in-out infinite alternate; }
    }
    @keyframes driftingWorldMobile { 0% { transform: translate(0, 0) scale(1); } 100% { transform: translate(-3%, 0) scale(1.15); } }

    @media screen and (orientation: landscape) and (max-height: 600px) {
      .municipality-logo, .festive-message, #bg-static, .warm-flicker, .vignette, .particles-container { display: none !important; }
      #main-container { padding: 0 !important; justify-content: center !important; background: #000; }
      .video-wrapper { width: 100vw; height: 100vh; border: none; border-radius: 0; }
    }

    /* Effetti */
    .warm-flicker { position: absolute; inset: 0; background: radial-gradient(circle, rgba(255, 180, 50, 0.15), transparent 80%); z-index: 2; pointer-events: none; mix-blend-mode: overlay; animation: firePulse 4s ease-in-out infinite alternate; }
    @keyframes firePulse { 0% { opacity: 0.1; } 100% { opacity: 0.5; } }
    .particles-container { position: absolute; inset: 0; pointer-events: none; z-index: 5; overflow: hidden; }
    .snowflake { position: absolute; top: -10px; background: white; border-radius: 50%; opacity: 0.9; box-shadow: 0 0 3px white; }
    .ember { position: absolute; bottom: -20px; background: #ffcc00; border-radius: 50%; opacity: 0; filter: blur(2px); }
    .vignette { position: absolute; inset: 0; background: radial-gradient(circle at center, transparent 40%, rgba(0,0,0,0.7) 85%, black 100%); z-index: 6; pointer-events: none; }

    @keyframes fall { 0% { transform: translate(0, -10vh); } 100% { transform: translate(15vw, 110vh); } }
    @keyframes riseRight { 0% { transform: translateY(0) translateX(0); opacity: 0; } 20% { opacity: 0.8; } 100% { transform: translateY(-90vh) translateX(15vw); opacity: 0; } }
    @keyframes riseLeft { 0% { transform: translateY(0) translateX(0); opacity: 0; } 20% { opacity: 0.8; } 100% { transform: translateY(-90vh) translateX(-15vw); opacity: 0; } }
    @keyframes riseZigZag { 0% { transform: translateY(0) translateX(0); opacity: 0; } 25% { transform: translateY(-20vh) translateX(5vw); opacity: 0.8; } 75% { transform: translateY(-60vh) translateX(-5vw); opacity: 0.4; } 100% { transform: translateY(-90vh) translateX(0); opacity: 0; } }

    @media (prefers-reduced-motion: reduce) {
      * { animation: none !important; transition: none !important; }
      .particles-container { display: none !important; }
      .loading-overlay .spinner{ animation: spin .9s linear infinite !important; }
    }
  </style>
</head>

<body>
  <div id="bg-static"></div>
  <div class="warm-flicker"></div>
  <div class="vignette"></div>
  <div class="particles-container" id="particlesContainer"></div>

  <div id="main-container">
    <img src="stemma2-removebg-preview.png" alt="Stemma Comune di Montefalcone" class="municipality-logo">

    <div class="festive-message">
      Il comune di Montefalcone di Val Fortore<br>
      augura a tutti Buone Feste
    </div>

    <div class="video-wrapper" id="videoWrapper">
      <video id="liveVideo" muted autoplay playsinline preload="auto" crossorigin="anonymous"></video>

      <div class="loading-overlay" aria-hidden="true">
        <img class="preview" src="https://www.webcammontefalconedivalfortore.it/p.png" alt="">
        <div class="spinner"></div>
      </div>

      <div class="tap-layer" id="tapLayer" aria-hidden="true"></div>

      <div class="live-badge" aria-hidden="true">
        <span class="live-dot"></span><span>LIVE</span>
      </div>

      <div class="osd" aria-hidden="true">
        <button class="glass-btn osd-chip" id="osdBtn" type="button" aria-label="Play/Pausa">
          <svg class="osd-icon play" viewBox="0 0 24 24" aria-hidden="true"><path d="M8 5v14l11-7z"></path></svg>
          <svg class="osd-icon pause" viewBox="0 0 24 24" aria-hidden="true"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"></path></svg>
        </button>
      </div>

      <button class="glass-btn fs-btn" id="fsBtn" type="button" aria-label="Fullscreen">
        <svg class="fs-icon" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M7 14H5v5h5v-2H7v-3zm0-4h2V7h3V5H5v5zm12 9h-3v2h5v-5h-2v3zm0-14V5h-5v2h3v3h2V5z"/>
        </svg>
      </button>
    </div>
  </div>

  <script>
    // blocco scroll/zoom
    document.addEventListener('touchmove', (e) => e.preventDefault(), { passive: false });
    document.addEventListener('wheel', (e) => { if (e.ctrlKey) e.preventDefault(); }, { passive: false });
    document.addEventListener('keydown', (e) => {
      if (e.ctrlKey && (e.key === '+' || e.key === '-' || e.key === '=' || e.key === '0')) e.preventDefault();
    }, { passive: false });
    ['gesturestart','gesturechange','gestureend'].forEach(evt => {
      document.addEventListener(evt, (e) => e.preventDefault(), { passive: false });
    });

    // particelle
    function createParticles() {
      const container = document.getElementById('particlesContainer');
      if (!container) return;

      const isMobile = window.innerWidth < 768;
      const snowCount = isMobile ? 35 : 70;
      const emberCount = isMobile ? 15 : 30;
      const speedModifier = isMobile ? 1.5 : 1;

      for (let i = 0; i < snowCount; i++) {
        const flake = document.createElement('div');
        flake.classList.add('snowflake');
        const size = Math.random() * 3 + 2;
        flake.style.width = size + 'px';
        flake.style.height = size + 'px';
        flake.style.left = (Math.random() * 120 - 10) + 'vw';
        const duration = (Math.random() * 4 + 4) * speedModifier;
        flake.style.animation = `fall ${duration}s linear infinite`;
        flake.style.animationDelay = '-' + (Math.random() * 5) + 's';
        container.appendChild(flake);
      }

      const animations = ['riseRight', 'riseLeft', 'riseZigZag'];
      for (let i = 0; i < emberCount; i++) {
        const ember = document.createElement('div');
        ember.classList.add('ember');
        const size = Math.random() * 4 + 3;
        ember.style.width = size + 'px';
        ember.style.height = size + 'px';
        ember.style.left = Math.random() * 100 + 'vw';
        const duration = (Math.random() * 6 + 6) * speedModifier;
        const randomAnim = animations[Math.floor(Math.random() * animations.length)];
        ember.style.animation = `${randomAnim} ${duration}s linear infinite`;
        ember.style.animationDelay = '-' + (Math.random() * 10) + 's';
        container.appendChild(ember);
      }
    }
    if (!window.matchMedia?.('(prefers-reduced-motion: reduce)').matches) createParticles();

    (function () {
      const VIDEO_SRC = "https://live.webcammontefalconedivalfortore.it/memfs/58e0bcbe-f1bd-4c8b-85f7-b4566a3e5392.m3u8";

      const wrapper = document.getElementById('videoWrapper');
      const video = document.getElementById('liveVideo');
      const tapLayer = document.getElementById('tapLayer');
      const osdBtn = document.getElementById('osdBtn');
      const fsBtn = document.getElementById('fsBtn');

      if (!wrapper || !video) return;

      video.controls = false;

      function setReady(ready){ wrapper.classList.toggle('is-ready', !!ready); }
      function setPausedUI(){ wrapper.classList.toggle('is-paused', !!video.paused); }

      // controls: tap 1 show/hide + autohide
      const AUTOHIDE_MS = 4000;
      let t = null;

      function clearHide(){ if (t) clearTimeout(t); t = null; }
      function scheduleHide(){ clearHide(); t = setTimeout(() => wrapper.classList.remove('controls-visible'), AUTOHIDE_MS); }
      function showControls(){ wrapper.classList.add('controls-visible'); scheduleHide(); }
      function hideControls(){ wrapper.classList.remove('controls-visible'); clearHide(); }
      function toggleControls(){ wrapper.classList.contains('controls-visible') ? hideControls() : showControls(); }

      tapLayer.addEventListener('click', toggleControls, { passive:true });
      wrapper.addEventListener('pointermove', () => wrapper.classList.contains('controls-visible') && scheduleHide(), { passive:true });
      wrapper.addEventListener('touchstart', () => wrapper.classList.contains('controls-visible') && scheduleHide(), { passive:true });
      wrapper.addEventListener('mousemove', () => wrapper.classList.contains('controls-visible') && scheduleHide(), { passive:true });

      // blocca propagazione sui bottoni
      function stop(e){ e.stopPropagation(); }
      ['pointerdown','mousedown','touchstart','click'].forEach(evt => {
        osdBtn.addEventListener(evt, stop, { passive: evt !== 'click' });
        fsBtn.addEventListener(evt, stop, { passive: evt !== 'click' });
      });

      // live edge helpers
      function getSeekableEnd(){
        try {
          const s = video.seekable;
          if (s && s.length) return s.end(s.length - 1);
        } catch(e){}
        return null;
      }
      const MAX_BEHIND_SEC = 20;
      const TARGET_BEHIND_SEC = 2.5;

      function snapToLive(force=false){
        const end = getSeekableEnd();
        if (end == null) return;
        const behind = end - (video.currentTime || 0);
        if (force || behind > MAX_BEHIND_SEC || behind < 0) {
          try { video.currentTime = Math.max(0, end - TARGET_BEHIND_SEC); } catch(e){}
        }
      }

      // play/pause solo bottone
      osdBtn.addEventListener('click', () => {
        if (video.paused) {
          setReady(false);
          snapToLive(true);
          video.play().catch(()=>{});
        } else {
          video.pause();
        }
        showControls();
      });

      // fullscreen robusto
      function isFs(){ return document.fullscreenElement || document.webkitFullscreenElement; }

      async function enterFs(){
        // iOS Safari: fullscreen solo sul video
        if (video.webkitEnterFullscreen && /iPhone|iPad|iPod/i.test(navigator.userAgent)) {
          try { video.webkitEnterFullscreen(); return; } catch(e){}
        }
        try {
          if (wrapper.requestFullscreen) await wrapper.requestFullscreen();
          else if (wrapper.webkitRequestFullscreen) await wrapper.webkitRequestFullscreen();
        } catch(e){}
      }

      async function exitFs(){
        try {
          if (document.exitFullscreen) await document.exitFullscreen();
          else if (document.webkitExitFullscreen) await document.webkitExitFullscreen();
        } catch(e){}
      }

      fsBtn.addEventListener('click', async () => {
        if (!isFs()) await enterFs();
        else await exitFs();
        showControls();
      });

      // HLS
      let hls = null;
      function destroyHls(){ if (hls){ try{hls.destroy();}catch(e){} hls=null; } }
      function isNativeHls(){ return video.canPlayType('application/vnd.apple.mpegurl'); }

      function initStream(){
        setReady(false);
        setPausedUI();

        destroyHls();
        try { video.pause(); } catch(e){}
        try { video.removeAttribute('src'); video.load(); } catch(e){}

        if (window.Hls && Hls.isSupported() && !isNativeHls()) {
          hls = new Hls({
            lowLatencyMode: true,
            backBufferLength: 30,
            maxBufferLength: 30,
            liveSyncDuration: 3,
            liveMaxLatencyDuration: 20,
            maxLiveSyncPlaybackRate: 1.5,
            enableWorker: true
          });

          hls.attachMedia(video);
          hls.on(Hls.Events.MEDIA_ATTACHED, () => hls.loadSource(VIDEO_SRC));
          hls.on(Hls.Events.MANIFEST_PARSED, () => video.play().catch(()=>{}));
          hls.on(Hls.Events.ERROR, (evt, data) => {
            if (!data || !data.fatal) return;
            if (data.type === Hls.ErrorTypes.NETWORK_ERROR) { try { hls.startLoad(-1); } catch(e){} }
            else if (data.type === Hls.ErrorTypes.MEDIA_ERROR) { try { hls.recoverMediaError(); } catch(e){} }
            else { setTimeout(initStream, 800); }
          });
        } else {
          video.src = VIDEO_SRC;
          try { video.load(); } catch(e){}
          video.play().catch(()=>{});
        }
      }

      video.addEventListener('loadedmetadata', () => setPausedUI());
      video.addEventListener('playing', () => {
        setReady(true);
        setPausedUI();

        // warm 1 frame (ma i bottoni sono già warm con opacity 0.001)
        wrapper.classList.add('controls-visible');
        requestAnimationFrame(() => requestAnimationFrame(() => wrapper.classList.remove('controls-visible')));
      });
      video.addEventListener('pause', () => { setPausedUI(); showControls(); });
      video.addEventListener('error', () => { setReady(false); setTimeout(initStream, 1200); });

      setInterval(() => { if (!video.paused) snapToLive(false); }, 8000);

      let hiddenAt = 0;
      document.addEventListener('visibilitychange', () => {
        if (document.visibilityState === 'hidden') {
          hiddenAt = Date.now();
          if (hls) { try { hls.stopLoad(); } catch(e){} }
          return;
        }
        const dt = Date.now() - (hiddenAt || Date.now());
        if (dt > 1200) initStream();
        else setTimeout(() => snapToLive(true), 200);
      });

      window.addEventListener('pageshow', (e) => { if (e.persisted) initStream(); });

      hideControls();
      initStream();
      setPausedUI();
    })();
  </script>
</body>
</html>
